<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Abrindo MI Electric...</title>
</head>
<body>
    <script>
        const params = new URLSearchParams(window.location.search);
        
        const recordId = params.get('recordId') || '';
        const cliente = params.get('cliente') || '';
        const nomeResponsavel = params.get('Nomeresponsavel') || '';
        const email = params.get('email') || '';

        const deeplink = `mielectric://novo?recordId=${encodeURIComponent(recordId)}`
            + `&cliente=${encodeURIComponent(cliente)}`
            + `&Nomeresponsavel=${encodeURIComponent(nomeResponsavel)}`
            + `&email=${encodeURIComponent(email)}`;

        window.location.href = deeplink;

        const tentarFecharPagina = () => {
            try {
                window.close();
                window.open('', '_self');
                window.close();
            } catch (_) {
                // sem ação: navegador pode bloquear fechamento programático
            }
        };

        setTimeout(tentarFecharPagina, 800);

        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                setTimeout(tentarFecharPagina, 300);
            }
        });
    </script>

    <p id="status">Abrindo MI Electric... <a href="#" id="link">Clique aqui se não abrir automaticamente.</a></p>

    <script>
        document.getElementById('link').href = deeplink;

        setTimeout(() => {
            if (!document.hidden) {
                document.getElementById('status').innerHTML =
                    'Se o aplicativo já abriu, você pode fechar esta aba. ' +
                    '<a href="#" id="link2">Clique aqui para tentar abrir novamente.</a>';
                document.getElementById('link2').href = deeplink;
            }
        }, 2000);
    </script>
</body>
</html>
```

---

## ✅ URL do botão no Salesforce (agora é https:// válido!)

Supondo que você hospede em `https://mielectric.com.br/open`:
```
https://mielectric.com.br/open?recordId={!Opportunity.Proposta__c}&cliente={!URLENCODE(Opportunity.MI_Nome_Conta__c)}&Nomeresponsavel={!URLENCODE(Opportunity.MI_Nome_Responsavel__c)}&email={!URLENCODE(Opportunity.MI_Email_Responsavel__c)}
